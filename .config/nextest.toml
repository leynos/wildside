# .config/nextest.toml
[profile.default]
# Kill any test once it crosses 60s, unless overridden for slower suites.
slow-timeout = { period = "60s", terminate-after = 1, grace-period = "5s" }

# Put a hard ceiling on the whole run.
global-timeout = "60m"

# Embedded Postgres test binaries share a single cluster directory at
# /var/tmp/pg-embed-{uid}/. The library's shared_cluster_handle() uses
# in-process locking (OnceLock), but nextest runs each binary in its own
# process. Serialize these binaries so only one bootstraps the cluster at
# a time; subsequent binaries reuse the already-running instance.

[test-groups.pg-embed]
max-threads = 1

[[profile.default.overrides]]
filter = """
  binary(diesel_user_repository)
  | binary(diesel_user_preferences_repository)
  | binary(diesel_route_annotation_repository)
  | binary(diesel_example_data_runs_repository)
  | binary(er_snapshots_bdd)
  | binary(example_data_seeding_bdd)
  | binary(example_data_runs_bdd)
  | binary(catalogue_descriptor_ingestion_bdd)
  | binary(catalogue_descriptor_read_models_bdd)
  | binary(ports_behaviour)
  | binary(pg_embed_isolation)
  | binary(schema_baseline_bdd)
"""
test-group = "pg-embed"
threads-required = 4
slow-timeout = { period = "300s", terminate-after = 1, grace-period = "5s" }
