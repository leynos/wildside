asyncapi: 3.0.0
info:
  title: myapp events
  description: Events emitted by the wildside backend
  version: 0.1.0
servers:
  production:
    host: ws.yourdomain.example
    protocol: ws
    pathname: /
    description: Production WebSocket server
channels:
  /ws:
    address: /ws
    messages:
      userCreated:
        $ref: '#/components/messages/UserCreated'
operations:
  userCreated:
    x-operationId: userCreated  # AsyncAPI 3 uses vendor field for stable codegen identifier
    summary: Receive UserCreated events
    action: receive
    channel:
      $ref: '#/channels/~1ws'
    messages:
      # Operation messages must reference channel-scoped names for validation
      - $ref: '#/channels/~1ws/messages/userCreated'
    tags:
      - name: users
        description: Events about system users
components:
  messages:
    UserCreated:
      name: UserCreated
      title: User created event
      contentType: application/json
      correlationId:
        location: "$message.payload#/trace_id"
      payload:
        type: object
        additionalProperties: false
        required:
          - trace_id
          - id
          - display_name
        properties:
          trace_id:
            type: string
            description: Correlation identifier for tracing across systems
            format: uuid
          id:
            type: string
            description: Unique user identifier
            examples: ["123e4567-e89b-42d3-a456-426614174001"]
            format: uuid
          display_name:
            type: string
            description: User's display name
            examples: ["Ada Lovelace"]
            # Keep in sync with backend/src/ws/display_name.rs
            minLength: 3
            maxLength: 32
            pattern: '^[A-Za-z0-9_ ]{3,32}$'
      examples:
        - name: minimal
          summary: Minimal valid payload
          payload:
            trace_id: "123e4567-e89b-42d3-a456-426614174000"
            id: "123e4567-e89b-42d3-a456-426614174001"
            display_name: "Ada Lovelace"
